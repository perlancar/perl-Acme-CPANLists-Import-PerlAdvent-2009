<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Pod::Advent 0.18 (Pod::Simple 3.10, Perl::Tidy 20090616) on 2009-12-26 01:12:32 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>2009 Perl Advent Calendar: No&euml;lvalue</title>
<link rel="stylesheet" href="../style.css" type="text/css" />
<link rel="alternate" type="text/plain" href="mod24.pod" />
</head>
<body>
<h1><a href="../">Perl Advent Calendar 2009-12</a>-24</h1>
<h2 align="center">No&euml;lvalue</h2>
<h3 align="center">by Jerrad Pierce</h3>
<p><tt><a href="http://search.cpan.org/perldoc?Match::Smart">lvalue</a></tt> provides some supplementary syntax for defining Lvalue subroutines in such a way as to overcome the two objections from <a href="http://perldoc.perl.org/perlsub.html#Lvalue-subroutines">perlsub</a> i.e;</p>
<ul>
<li>the inability to <a href="../../2005/21/">explicitly return</a></li>
<li>encapsulation violation preventing the testing of arguments</li>
</ul>
<pre><span class="c">nick@north# perl -l mod24.pl
Dasher, Dancer, Vixen, Comet, Cupid, Prancer, Dunder, Blixem
Dasher, Dancer, Vixen, Comet, Cupid, Prancer, Donner, Blitzen
expected reference to an array, you supplied a HASH at mod24.pl line 10.</span></pre>
<p>One minor nit with it though, is that punctuation is forbidden between the <tt><span class="w">get</span></tt> and <tt><span class="w">set</span></tt> blocks, which means that code formatters can be confused (as perltidy was below) and the second block's contents will likely be over-indented in your editor contents will be over-indented in your editor. Fortunately, you can specify your blocks in whichever order you prefer, so if one is much shorter than the other you can list it second to reduce the visual impact of misindenting.</p>
<a name="mod24.pl" id="mod24.pl"></a><h2><a href="mod24.pl">mod24.pl</a></h2><pre>
   1 <span class="k">use</span> <span class="w">lvalue</span><span class="sc">;</span>
   2 
   3 <span class="s">{</span>
   4     <span class="c"># Make it a closure too</span>
   5     <span class="k">my</span> <span class="i">$ary</span> = <span class="s">[</span><span class="q">qw/Dasher Dancer Vixen Comet Cupid Prancer Dunder Blixem/</span><span class="s">]</span><span class="sc">;</span>
   6 
<a name="reindeer"></a>   7     <span class="k">sub </span><span class="m">reindeer</span> <span class="co">:</span> <span class="w">lvalue</span> <span class="s">{</span>
   8       <span class="i">set</span> <span class="s">{</span>
   9 	<span class="k">my</span> <span class="i">$val</span> = <span class="k">shift</span><span class="sc">;</span>
  10 	<span class="k">die</span><span class="s">(</span><span class="q">&#39;expected reference to an array, you supplied a &#39;</span><span class="cm">,</span> <span class="k">ref</span> <span class="i">$val</span><span class="s">)</span>
  11 	  <span class="k">unless</span> <span class="k">ref</span> <span class="i">$val</span> <span class="k">eq</span> <span class="q">&#39;ARRAY&#39;</span><span class="sc">;</span>
  12 	<span class="k">return</span> <span class="i">$ary</span> = <span class="i">$val</span><span class="sc">;</span>
  13       <span class="s">}</span>
  14       <span class="i">get</span> <span class="s">{</span>
  15 	<span class="k">return</span> <span class="k">join</span> <span class="q">&#39;, &#39;</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$ary</span>}<span class="sc">;</span>
  16       <span class="s">}</span>
  17     <span class="s">}</span>
  18 <span class="s">}</span>
  19 
  20 <span class="k">print</span> <span class="i">reindeer</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  21 <span class="k">print</span> <span class="i">reindeer</span><span class="s">(</span><span class="s">)</span> = <span class="s">[</span><span class="q">qw/Dasher Dancer Vixen Comet Cupid Prancer Donner Blitzen/</span><span class="s">]</span><span class="sc">;</span>
  22 <span class="k">print</span> <span class="i">reindeer</span><span class="s">(</span><span class="s">)</span> = <span class="s">{</span><span class="w">foo</span><span class="cm">=&gt;</span><span class="q">&#39;bar&#39;</span><span class="s">}</span><span class="sc">;</span>
</pre>
<div style="float: right; font-size: 10pt"><a href="mod24.pod">View Source (POD)</a></div><br />
</body>
</html>
